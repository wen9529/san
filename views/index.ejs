<!-- views/index.ejs 安全增强版 -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:">
    <!-- 其他头部内容保持不变 -->
</head>
<body>
    <!-- 页面内容保持不变 -->

    <!-- 安全加载脚本 -->
    <script src="/socket.io/socket.io.js" integrity="sha384-..."></script>
    <script src="/js/socket_handler.js" integrity="sha256-<%= scriptHashes['socket_handler.js'] %>"></script>
    <script src="/js/card_renderer.js" integrity="sha256-<%= scriptHashes['card_renderer.js'] %>"></script>
    
    <!-- 脚本加载监控 -->
    <script>
    (function(){
      const ALLOWED_SCRIPTS = {
        '/socket.io/socket.io.js': true,
        '/js/socket_handler.js': true,
        '/js/card_renderer.js': true
      };

      // 脚本加载异常监控
      window.addEventListener('error', function(e) {
        if (!ALLOWED_SCRIPTS[e.filename]) {
          console.error('非法脚本入侵:', e.filename);
          document.body.innerHTML = `
            <h1 style="color:red;padding:20px">
              安全警报！检测到非法脚本：${e.filename}
            </h1>
          `;
          window.stop();
        }
      }, true);
    })();
    </script>
</body>
</html>
